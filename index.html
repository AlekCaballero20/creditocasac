<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CrÃ©dito Casa C - Control de Pagos</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="wrap header">
    <div>
      <h1>ğŸ¡ CrÃ©dito Casa C</h1>
      <p class="muted">Pagos, avance y fecha estimada de finalizaciÃ³n. Todo clarito, sin sufrimiento.</p>
    </div>

    <div class="headerActions">
      <button id="btnReload" class="btn" title="Actualizar datos">ğŸ”„ Actualizar</button>
    </div>
  </header>

  <main class="wrap">
    <!-- BLOQUE: PROGRESO PRINCIPAL -->
    <section class="card block hero" aria-label="Resumen principal del crÃ©dito">
      <div class="heroTop">
        <div>
          <h2 class="heroTitle">ğŸ“Œ Estado del crÃ©dito</h2>
          <p class="muted heroSub">Este resumen se calcula con el histÃ³rico del documento.</p>
        </div>

        <div class="heroBadge" id="heroBadge" title="Estado">
          â³ En curso
        </div>
      </div>

      <div class="heroGrid">
        <div class="heroProgress">
          <div class="progressHeader">
            <div class="progressLabel">Avance</div>
            <div class="progressPercent" id="progressPercent">â€”%</div>
          </div>

          <div class="progressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="progressFill" id="progressFill" style="width:0%"></div>
          </div>

          <div class="progressFoot">
            <span class="muted">Abonado: <strong id="progressPaid">$0</strong></span>
            <span class="muted">Restante: <strong id="progressLeft">$0</strong></span>
          </div>
        </div>

        <div class="heroKpis">
          <div class="kpi">
            <div class="kpiLabel">ğŸ’³ Total del crÃ©dito</div>
            <div class="kpiValue" id="totalCredito">$0</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">âœ… Pagos realizados (total abonado)</div>
            <div class="kpiValue" id="totalAbonado">$0</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">ğŸ§¾ Saldo pendiente</div>
            <div class="kpiValue" id="saldoRestante">$0</div>
          </div>
          <div class="kpi">
            <div class="kpiLabel">ğŸ•’ Ãšltimo pago</div>
            <div class="kpiValue" id="ultimoPago">â€”</div>
            <div class="kpiHint" id="ultimoPagoValor"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- BLOQUE: KPI EXTRA (SÃšPER ENTENDIBLE) -->
    <section class="grid cards" aria-label="Indicadores rÃ¡pidos">
      <article class="card kpiCard">
        <div class="label">ğŸ“… Meses con pagos registrados</div>
        <div class="value" id="kpiMonthsWithPayments">â€”</div>
        <div class="hint">CuÃ¡ntos meses aparecen con abonos.</div>
      </article>

      <article class="card kpiCard">
        <div class="label">ğŸ“Š Promedio mensual (histÃ³rico)</div>
        <div class="value" id="kpiAvgMonthlyAll">â€”</div>
        <div class="hint">Promedio usando todo el historial.</div>
      </article>

      <article class="card kpiCard">
        <div class="label">âš¡ Promedio Ãºltimos 6 meses (con pago)</div>
        <div class="value" id="kpiAvgMonthly6">â€”</div>
        <div class="hint">Para estimar mejor la recta final.</div>
      </article>

      <article class="card kpiCard">
        <div class="label">ğŸ¯ Meta de este mes (manual)</div>
        <div class="value" id="kpiMonthlyGoal">â€”</div>
        <div class="hint">Si quieren ponerse una cuota fija.</div>
      </article>
    </section>

    <!-- BLOQUE: PROYECCIÃ“N (MÃS AMIGABLE) -->
    <section class="card block">
      <div class="blockHeader">
        <div>
          <h2>ğŸ”® EstimaciÃ³n de finalizaciÃ³n</h2>
          <p class="muted tiny">Es una estimaciÃ³n basada en el comportamiento de pagos. No incluye intereses bancarios (si aplican).</p>
        </div>
        <div class="pill" id="projectionPill">ğŸ“ EstimaciÃ³n</div>
      </div>

      <div class="controls">
        <label class="control">
          <span>Modo de cÃ¡lculo</span>
          <select id="projectionMode" aria-label="Modo de cÃ¡lculo de proyecciÃ³n">
            <option value="last_month_avg_6">ğŸ“Œ Promedio mensual (Ãºltimos 6 meses con pago)</option>
            <option value="last_month">ğŸ§¾ Usar el valor del Ãºltimo mes con pago</option>
            <option value="all_month_avg">ğŸ“Š Promedio mensual (todo el histÃ³rico)</option>
            <option value="manual">âœï¸ Cuota mensual manual</option>
          </select>
        </label>

        <label class="control" id="manualWrap">
          <span>Cuota mensual (manual)</span>
          <input id="manualMonthly" type="number" min="0" step="1000" inputmode="numeric" placeholder="Ej: 900000" />
          <small class="muted tiny">Tip: si ponen una cuota fija, la estimaciÃ³n se vuelve mÃ¡s clara.</small>
        </label>

        <div class="projectionResult" aria-label="Resultados de la proyecciÃ³n">
          <div class="label">ğŸ’° Pago mensual usado</div>
          <div class="value" id="monthlyUsed">$0</div>

          <div class="label">â³ Meses que faltan (aprox.)</div>
          <div class="value" id="monthsLeft">â€”</div>

          <div class="label">ğŸ Se terminarÃ­a hacia</div>
          <div class="value" id="payoffDate">â€”</div>

          <div class="miniProgress">
            <div class="miniRow">
              <span class="muted">Avance</span>
              <strong id="miniPercent">â€”%</strong>
            </div>
            <div class="miniBar">
              <div class="miniFill" id="miniFill" style="width:0%"></div>
            </div>
            <div class="muted tiny" id="miniNote">Mientras mÃ¡s constante sea el pago, mÃ¡s confiable la fecha estimada.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- BLOQUE: HISTÃ“RICO -->
    <section class="card block">
      <div class="blockHeader">
        <div>
          <h2>ğŸ“š HistÃ³rico de pagos</h2>
          <p class="muted tiny">Puedes buscar por mes, aÃ±o o valor. La tabla muestra acumulado y saldo.</p>
        </div>

        <div class="tableTools" aria-label="Filtros de bÃºsqueda">
          <input id="search" class="input" placeholder="ğŸ” Buscar (mes, aÃ±o, valorâ€¦)" aria-label="Buscar" />
          <select id="yearFilter" class="input" aria-label="Filtrar por aÃ±o">
            <option value="">Todos los aÃ±os</option>
          </select>
        </div>
      </div>

      <div class="tableWrap">
        <table id="table" aria-label="Tabla de histÃ³rico">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Mes</th>
              <th class="right">Valor</th>
              <th class="right">Acumulado</th>
              <th class="right">Saldo</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="statusRow">
        <p class="muted tiny" id="status"></p>
        <p class="muted tiny" id="lastUpdated">ğŸ•“ Ãšltima actualizaciÃ³n: <span id="lastUpdatedValue">â€”</span></p>
      </div>
    </section>
  </main>

  <footer class="wrap footer muted">
    Hecho para que no tengan que pelear con tablas. ğŸ™ƒğŸ’›
  </footer>

  <!-- Micro-animaciones / UX suave sin depender del JS -->
  <script>
    // Suaviza el foco para gente mayor (menos "salto" visual)
    document.addEventListener("click", (e) => {
      const t = e.target;
      if (t && (t.tagName === "BUTTON" || t.tagName === "SELECT" || t.tagName === "INPUT")) {
        t.classList.add("touched");
        setTimeout(() => t.classList.remove("touched"), 250);
      }
    });
  </script>

  <script type="module" src="./app.js"></script>
</body>
</html>
